---
title: "【自分用】Riverpodについて"
emoji: "😊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

## そもそも状態管理とは。なぜRiverpodが必要なのか
- 状態管理はフロントから生まれた
- 当初のフロントはデータを静的なHTMLに変換するだけ
- しかし最近では動的にUIが変わっていくため、データの移り変わりが必要となった
- そこで宣言的にUIを構築するReactがでてきた。それによって引数によって与えられた今・現在のデータをHTMLとして表現する
- つまりテーマがUIの移り変わりからデータの移り変わりとなった
- このデータの移り変わりを管理するのが「状態管理」という

[Flutter公式のStateについて](https://docs.flutter.dev/data-and-backend/state-mgmt/intro)
（Flutter公式からの引用）
- アプリのstateが変更されると、UIの再描画が実行される。再描画はゼロから再構築される
- 広義でのアプリの状態とは、実行時にメモリ上に存在するすべてのものを指す
- 具体的な定義では、「UIをいつでも再構築するために必要なデータ」「自分で管理するstateの種類は、ephemeral state とapp state」
- Ephemeral state: １つのウィジェットにきちんと格納できる状態のこと
  - 例えば
    - PageViewの現在のページ、複雑なAnimationの現在の進行状況、BottomNavigationBarで現在選択されているタブ
  - この種の状態に対して状態管理技術を使う必要はなくStatefulWidgetを使えばいい
- App state: 一時的はなくアプリのさまざまな部分で共有し、ユーザーセッション間で保持したい状態を、アプリケーション状態という
  - 例
    - ユーザー設定
    - ログイン情報
    - SNSアプリの通知
    - ニュースアプリ記事の既読かどうか
- まとめると、Flutterアプリの状態にはephemeralとapp stateの２つがある
  - EphemeralはStateとsetStateを使って実装でき、多くの場合は１つのウィジェットでまとまる
  - 残りがApp state。
  - これらを単純に区別できるわけではなく、最終的には経験則となる。（ただシンプルなアプリでは、則れる）

Providerを利用するうえでの重要な３つの概念
- ChangeNotifier
  - リスナーに変更通知を提供。何かがChangeNotifierであれば、その変更を購読することができる
  - アプリケーション状態をカプセル化する方法のひとつ
- ChangeNotifierProvider
  - ChangeNotifierのインスタンスを子孫に提供するウィジェット
- Consumer
  - 唯一の引数はビルダー。Builderは、ChangeNotifierが変更されるたびに呼び出される関数。モデル内でnorifyListenersを呼び出すと、対応するすべてのConsumerウィジェットのBuilderメソッドが呼び出される
  - Consumerウィジェットをツリーのできるだけ深いところに配置することがベスト


◯Riverpod sampleアプリ

### ネットワーク：https://riverpod.dev/ja/docs/essentials/first_request
ネットワークリクエストを行うときの基本的要件
- リクエストが行われている間、UIはローディング状態をレンダリング
- エラー処理
- 可能であればリクエストはキャッシュする

mainのところでrunAppのところで、ProviderScopeをつける。→アプリケーション全体でRiverpodが有効になる
- ネットワークリクエストの実行は、通常「ビジネスロジック」と呼ばれる
- ビジネスロジックはプロバイダの中に配置される
- プロバイダはスーパーパワー関数（？）。
- プロバイダの利点
  - キャッシュされる
  - デフォルトのエラー/ロード処理
  - リッスンが可能
  - データが変更されたときに自動的に再実行される
以上の利点により、GETリクエストの要件に適合する







Riverpodの特性
- ステートレス ウィジェットと同様の方法でビジネス ロジックを記述します。 必要に応じてネットワークに自動的に再計算を要求させ、ロジックを簡単に再利用/構成/保守可能にします。
- Riverpod を使用すると、「プルして更新」/「入力しながら検索」などの一般的だが複雑な UI パターンを、わずか数行のコードで実現できます。
- Riverpod は、よくある間違いをコンパイル エラーにすることでコンパイラを強化します。カスタム lint ルールとリファクタリング オプションも提供します。ドキュメントを生成するためのコマンドラインもあります。


